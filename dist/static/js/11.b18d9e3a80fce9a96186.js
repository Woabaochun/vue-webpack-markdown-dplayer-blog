webpackJsonp([11],{P5xD:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Dd8w"),r=a.n(i),l=(a("7+uW"),a("NYxO")),s=(a("DlMc"),{name:"",computed:r()({},Object(l.b)(["TOKEN"])),data:function(){var t=this;return{buttonValue:"發布文章",editId:"",inputVisible:!1,inputValue:"",formData:{type:"0",articleContent:this.$store.state.articleContent,articleUrl:"",articleTitle:"",articleTabloid:"",articleTags:this.$store.state.articleTags},rules:{articleUrl:[{required:!1,message:"請輸入封面URL",trigger:["blur","change"]},{validator:function(e,a,i){t.isUrl||""==t.formData.articleUrl?i():i(new Error("URL無效"))},trigger:"blur"}],articleTags:[{type:"array",required:!0,message:"請至少添加一個標簽",trigger:"blur"}],articleTabloid:[{required:!0,message:"文章小報不能為空",trigger:"blur"},{min:10,max:300,message:"文本長度在 10 到 300 個字符",trigger:"blur"}]},propArticleUrl:"articleUrl",propArticleTabloid:"articleTabloid",PropArticleTags:"articleTags",formRules:{},restaurants:[],isUrl:!1}},created:function(){this.$store.commit("setEditorRou",!0),this.$store.commit("setArticleContent","");var t=this.$route.query.data;if(t){var e=(t=this.crypto.jsonDecrypt(t)).id,a=t.type;e&&(this.$store.commit("setArticleTitle","更新文章"),this.buttonValue="更新文章",this.editId=e,this.formData.type=a,this.loadUpData())}else this.$store.commit("setArticleTitle","寫文章")},activated:function(){},mounted:function(){this.radioType(this.formData.type),this.$store.state.editor.setOption("value","")},methods:{loadUpData:function(){var t=this,e={id:this.editId,type:this.formData.type};this.ios.seeArticle(e).then(function(e){if(0==e.data.ret){var a=e.data.data;t.$store.state.editor.setOption("value",a.data.article_content),t.formData.articleContent=a.data.article_content,t.formData.articleUrl=a.data.article_url,t.formData.articleTitle=a.data.article_title,t.formData.articleTabloid=a.data.article_tabloid,a.data.article_tags&&(t.formData.articleTags=JSON.parse(a.data.article_tags))}else t.$message({icon:"fail",message:e.msg})}).catch(function(e){e.data&&t.$message({icon:"fail",message:e.data.msg})})},postFrom:function(){var t=this,e=this;return""==this.formData.articleTitle?(this.$message({message:"文章標題不能為空！",type:"warning"}),void document.querySelector("#titleInput").scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):this.formData.articleTitle.length<10||this.formData.articleTitle.length>100?(this.$message({message:"標題長度在 10 到 100 個字符！",type:"warning"}),void document.querySelector("#titleInput").scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):(this.formData.articleContent=this.$store.state.articleContent,""==this.formData.articleContent?(this.$message({message:"文章內容不能為空!",type:"warning"}),void document.querySelector("#contentInput").scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):this.formData.articleContent.length>5e3?(this.$message({message:"文章內容不能超過5000！",type:"warning"}),void document.querySelector("#contentInput").scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):void this.$refs.formData.validate(function(a){if(a){var i=document.getElementById("insImageUrl"),r=0;i&&(r=parseFloat(i.clientHeight/i.clientWidth).toFixed(2),t.formData.articleType=r.toString()),""!=t.editId?(t.formData.id=t.editId,t.ios.updataArticle(t.formData).then(function(t){e.$store.state.selectChange.dropCont(),e.formData={type:"0",articleContent:"",articleUrl:"",articleTitle:"",articleTabloid:"",articleTags:[]},e.$message({icon:"fail",message:t.data.data.msg}),e.$router.go(-1)}).catch(function(t){t.data&&(e.$message({icon:"fail",message:t.data.msg}),"文章標題已被使用！"==t.data.msg&&document.querySelector("#titleInput").scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}))})):(t.formData.articleType=r,t.ios.addArticle(t.formData).then(function(t){e.$store.state.selectChange.dropCont(),e.$store.commit("setArticleTags",e.formData.articleTags),e.formData={type:"0",articleContent:"",articleUrl:"",articleTitle:"",articleTabloid:"",articleTags:[]},e.$message({icon:"fail",message:t.data.data.msg}),e.$router.go(-1)}).catch(function(e){e.data&&(t.$message({icon:"fail",message:e.data.msg}),"文章標題已被使用！"==e.data.msg&&document.querySelector("#titleInput").scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}))}))}else document.querySelector("#formData").scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}))},radioType:function(t){"2"===t?(this.rules.articleTabloid[0].required=!1,this.rules.articleUrl[0].required=!0,this.$refs.articleUrl.clearValidate(),this.$refs.articleTags.clearValidate(),this.$refs.articleTabloid.clearValidate(),this.propArticleUrl="articleUrl",this.PropArticleTags="articleTags"):"1"===t?(this.rules.articleTabloid[0].required=!0,this.$refs.articleTabloid.clearValidate(),this.formData.articleUrl="",this.PropArticleTags="",this.propArticleUrl=null,this.formData.articleTags=[]):(this.rules.articleTabloid[0].required=!0,this.$refs.articleUrl.clearValidate(),this.$refs.articleTags.clearValidate(),this.$refs.articleTabloid.clearValidate(),this.rules.articleUrl[0].required=!1,this.propArticleUrl="articleUrl",this.PropArticleTags="articleTags")},imageLoad:function(t){this.isUrl=!0},imageError:function(t){""!=this.formData.articleUrl&&(this.isUrl=!1)},handleClose:function(t){this.formData.articleTags.splice(this.formData.articleTags.indexOf(t),1)},showInput:function(){var t=this;this.inputVisible=!0,this.$nextTick(function(e){t.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var t=this,e=this.inputValue;if(e){for(var a={text:e,type:"info"},i=0;i<this.formData.articleTags.length;i++)if(this.formData.articleTags[i].text==e)return this.formData.articleTags[i].type="warning",void setTimeout(function(){t.formData.articleTags[i].type="info"},500);this.formData.articleTags.push(a),this.inputVisible=!1,this.inputValue=""}else this.inputVisible=!1,this.inputValue=""},querySearch:function(t,e){var a=this.restaurants;e(t?a.filter(this.createFilter(t)):a)},createFilter:function(t){return function(e){return 0===e.value.toLowerCase().indexOf(t.toLowerCase())}},handleSelect:function(t){console.log(t)},handleIconClick:function(t){console.log(t)}}}),o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"bodyWrapper"},[a("el-row",{staticClass:"title"},[a("el-col",{staticClass:"titlecol",attrs:{span:20}},[a("el-form",{ref:"formData",attrs:{model:t.formData}},[a("el-form-item",[a("el-input",{staticClass:"titleInput",attrs:{id:"titleInput",type:"text",placeholder:"請輸入標題",maxlength:"100","show-word-limit":""},model:{value:t.formData.articleTitle,callback:function(e){t.$set(t.formData,"articleTitle",e)},expression:"formData.articleTitle"}})],1)],1),t._v(" "),a("markdown-edit",{staticStyle:{margin:"auto",height:"auto","max-width":"100%"},attrs:{id:"contentInput"}})],1),t._v(" "),a("van-tabbar",{attrs:{"z-index":"6","active-color":"#e35885","inactive-color":"#7d7e80",fixed:""}},[a("el-col",{staticClass:"titlecol-button",attrs:{span:20}},[a("el-button",{attrs:{id:"install",type:"info",icon:"el-icon-thumb"},on:{click:function(e){return t.postFrom()}}},[t._v(t._s(t.buttonValue))])],1)],1)],1),t._v(" "),a("el-row",{staticClass:"contentblog"},[a("el-col",{staticClass:"titlecol",attrs:{span:20}},[a("el-form",{ref:"formData",attrs:{model:t.formData,rules:t.rules,id:"formData"}},[t.TOKEN.userPower&&!t.editId&&t.TOKEN.level>=2?a("el-form-item",{attrs:{label:"發布板塊"}},[a("el-radio-group",{on:{change:t.radioType},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},[a("el-radio",{attrs:{label:"0"}},[t._v("首頁")]),t._v(" "),t.TOKEN.level>=2?a("el-radio",{attrs:{label:"1"}},[t._v("熱門")]):t._e(),t._v(" "),t.TOKEN.level>=3?a("el-radio",{attrs:{label:"2"}},[t._v("視頻")]):t._e()],1)],1):t._e(),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"1"!=t.formData.type,expression:"formData.type != '1'"}],ref:"articleUrl",staticClass:"image_url",attrs:{label:"封面展示",prop:t.propArticleUrl}},[a("el-input",{staticClass:"formInput",attrs:{placeholder:"請輸入封面URL",onkeyup:"this.value=this.value.replace('\\{','').replace('\\}','')"},model:{value:t.formData.articleUrl,callback:function(e){t.$set(t.formData,"articleUrl",e)},expression:"formData.articleUrl"}},[a("template",{slot:"prepend"},[t._v("URL://")])],2)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.formData.articleUrl,expression:"formData.articleUrl"}],staticClass:"contentblogimg"},[a("div",{staticClass:"demo-image__lazy"},[a("el-image",{key:t.formData.articleUrl,attrs:{id:"insImageUrl",src:t.formData.articleUrl,lazy:""},on:{error:t.imageError,load:t.imageLoad}},[a("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[t._v("\n                加载中"),a("span",{staticClass:"el-icon-loading"})])])],1)]),t._v(" "),a("el-form-item",{ref:"articleTabloid",staticClass:"image_url",attrs:{label:"文章小報",prop:t.propArticleTabloid}},[a("el-input",{attrs:{type:"textarea",rows:4,maxlength:"300","show-word-limit":""},model:{value:t.formData.articleTabloid,callback:function(e){t.$set(t.formData,"articleTabloid",e)},expression:"formData.articleTabloid"}})],1),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"1"!=t.formData.type,expression:"formData.type != '1'"}],ref:"articleTags",attrs:{label:"文章標簽",prop:t.PropArticleTags}},[t._l(t.formData.articleTags,function(e){return a("el-tag",{key:e.text,attrs:{type:e.type,closable:"","disable-transitions":!1},on:{close:function(a){return t.handleClose(e)}}},[t._v("\n            "+t._s(e.text)+"\n          ")])}),t._v(" "),t.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ 添加標簽")])],2)],1)],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(s,o,!1,function(t){a("aDoi")},"data-v-0ed6ac2a",null);e.default=n.exports},aDoi:function(t,e){}});